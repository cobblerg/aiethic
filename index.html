<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ê³µì§€ëŠ¥ ìœ¤ë¦¬ ìŠ¤í† ë¦¬ë³´ë“œì™€ í† ë¡ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; scroll-behavior: smooth; }
        .hidden { display: none; }
        .scenario-card { transition: all 0.3s ease; border: 2px solid transparent; }
        .scenario-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); }
        .selected-scenario {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            border-color: #6366f1; /* indigo-500 */
            background-color: #eef2ff; /* indigo-50 */
        }
        textarea { resize: vertical; }
        .speech-bubble {
            position: relative;
            background: #f1f5f9;
            border-radius: .4em;
        }
        .speech-bubble:after {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            width: 0;
            height: 0;
            border: 20px solid transparent;
            border-right-color: #f1f5f9;
            border-left: 0;
            border-bottom: 0;
            margin-top: -10px;
            margin-left: -20px;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #3498db;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <input type="file" id="image-upload-input" class="hidden" accept="image/*">

    <!-- Main Content -->
    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">ì¸ê³µì§€ëŠ¥ ìœ¤ë¦¬ ìŠ¤í† ë¦¬ë³´ë“œì™€ í† ë¡ </h1>
            <p class="mt-2 text-slate-600">ìš°ë¦¬ê°€ ë§ˆì£¼í•  AI ì‹œëŒ€ì˜ ìœ¤ë¦¬ì  ë”œë ˆë§ˆë¥¼ íƒìƒ‰í•´ë´…ì‹œë‹¤.</p>
        </header>

        <section id="scenario-selection" class="w-full max-w-4xl mx-auto">
            <h2 class="text-2xl font-semibold text-center mb-6">1. íƒêµ¬í•  ì‹œë‚˜ë¦¬ì˜¤ ì£¼ì œë¥¼ ì„ íƒí•˜ì„¸ìš”.</h2>
            <div id="scenario-list" class="grid md:grid-cols-2 gap-6"></div>
        </section>

        <main id="workshop-area" class="hidden w-full max-w-5xl mx-auto space-y-12">
            
            <section id="storyboard-section">
                <h2 class="text-2xl font-semibold mb-2">2. ì„ íƒí•œ ì‹œë‚˜ë¦¬ì˜¤ë¡œ ìŠ¤í† ë¦¬ë³´ë“œ ë§Œë“¤ê¸°</h2>
                <p class="mb-6 text-slate-500">ê° ì¥ë©´ì˜ ëŒ€ì‚¬ë¥¼ ìˆ˜ì •í•˜ê³ , [ì´ë¯¸ì§€ ìƒì„±] ë˜ëŠ” [ì´ë¯¸ì§€ ì¶”ê°€] ë²„íŠ¼ìœ¼ë¡œ ìš°ë¦¬ë§Œì˜ ì´ì•¼ê¸°ë¥¼ ì™„ì„±í•˜ì„¸ìš”.</p>
                <div id="storyboard-container" class="space-y-8"></div>
            </section>
            
            <section id="solution-section">
                <h2 class="text-2xl font-semibold mb-4">3. ìœ¤ë¦¬ì  ë”œë ˆë§ˆ í•´ê²° ë°©ì•ˆ ëª¨ìƒ‰í•˜ê¸°</h2>
                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-semibold text-lg">ì´ ë¬¸ì œë¥¼ ì–´ë–»ê²Œ í•´ê²°í•  ìˆ˜ ìˆì„ê¹Œìš”?</h3>
                        <button id="hint-button" class="bg-sky-500 text-white px-4 py-2 rounded-lg hover:bg-sky-600 transition">íŒíŠ¸ ë³´ê¸°</button>
                    </div>
                    <div id="hint-box" class="hidden bg-sky-50 p-4 rounded-lg mb-4 border border-sky-200">
                        <p class="font-bold text-sky-800">ğŸ’¡ ìƒê°í•´ ë³¼ ì </p>
                        <p id="hint-text" class="text-sky-700 mt-1"></p>
                    </div>
                    <textarea id="solution-textarea" class="w-full h-40 p-3 border rounded-lg focus:ring-2 focus:ring-sky-500 focus:outline-none" placeholder="ì—¬ëŸ¬ë¶„ íŒ€ì˜ ì°½ì˜ì ì¸ í•´ê²° ë°©ì•ˆì„ ì—¬ê¸°ì— ì‘ì„±í•´ì£¼ì„¸ìš”..."></textarea>
                </div>
            </section>
            
            <div class="text-center space-y-4">
                 <button id="download-presentation" class="bg-indigo-600 text-white font-bold px-8 py-3 rounded-lg hover:bg-indigo-700 transition shadow-md">
                    [ë°œí‘œ ìë£Œ ë‚´ë ¤ë°›ê¸°]
                </button>
                <button id="start-discussion-btn" class="bg-purple-600 text-white font-bold px-8 py-3 rounded-lg hover:bg-purple-700 transition shadow-md">
                    [ì‹¤ì‹œê°„ í† ë¡  ì‹œì‘í•˜ê¸°]
                </button>
            </div>
        </main>
    </div>

    <!-- Discussion Modal -->
    <div id="discussion-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50">
        <div class="bg-slate-50 rounded-2xl shadow-xl p-6 md:p-8 max-w-6xl w-full max-h-[90vh] overflow-y-auto relative">
            <button id="close-modal-btn" class="absolute top-4 right-4 text-slate-600 hover:text-slate-900 text-2xl font-bold">&times;</button>
            
            <section id="discussion-section">
                <h2 class="text-2xl font-semibold mb-4 text-center">ì°¬ë°˜ í† ë¡ í•˜ê¸° (ì‹¤ì‹œê°„)</h2>
                <div class="text-center bg-white p-4 rounded-xl shadow-md mb-6 max-w-3xl mx-auto">
                    <label for="discussion-title-input" class="font-bold text-lg text-indigo-800">í† ë¡  ì£¼ì œ</label>
                    <input type="text" id="discussion-title-input" class="w-full mt-2 p-2 border rounded-lg text-center focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                </div>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <input type="text" id="pro-title-input" class="font-bold text-lg text-center mb-3 p-2 bg-blue-100 text-blue-800 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <div id="pro-chat" class="chat-container h-64 overflow-y-auto bg-slate-100 p-3 rounded-lg border space-y-2"></div>
                        <div class="mt-3 flex">
                            <input type="text" id="pro-input" placeholder="ì˜ê²¬..." class="flex-grow p-2 border rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <button id="pro-send-btn" class="bg-blue-500 text-white px-4 rounded-r-lg hover:bg-blue-600">ì „ì†¡</button>
                        </div>
                    </div>
                    <div>
                         <input type="text" id="con-title-input" class="font-bold text-lg text-center mb-3 p-2 bg-red-100 text-red-800 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-red-500">
                        <div id="con-chat" class="chat-container h-64 overflow-y-auto bg-slate-100 p-3 rounded-lg border space-y-2"></div>
                        <div class="mt-3 flex">
                            <input type="text" id="con-input" placeholder="ì˜ê²¬..." class="flex-grow p-2 border rounded-l-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                            <button id="con-send-btn" class="bg-red-500 text-white px-4 rounded-r-lg hover:bg-red-600">ì „ì†¡</button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="reflection-section" class="mt-12">
                <h2 class="text-2xl font-semibold mb-4">í™œë™ ì†Œê° ë‚˜ëˆ„ê¸° (ì‹¤ì‹œê°„)</h2>
                 <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <div class="mb-4">
                        <label for="name-input" class="block font-medium mb-1">ì´ë¦„</label>
                        <input type="text" id="name-input" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:outline-none" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div>
                        <label for="reflection-textarea" class="block font-medium mb-1">ì†Œê°</label>
                        <textarea id="reflection-textarea" class="w-full h-32 p-3 border rounded-lg focus:ring-2 focus:ring-green-500 focus:outline-none" placeholder="ì˜¤ëŠ˜ í™œë™ì„ í†µí•´ ë°°ìš°ê³  ëŠë‚€ ì ì„ ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”."></textarea>
                    </div>
                     <div class="text-right mt-4">
                         <button id="save-reflection-btn" class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition">ì†Œê° ë‚¨ê¸°ê¸°</button>
                     </div>
                </div>
                <div id="reflection-list" class="mt-6 space-y-4">
                    <!-- Real-time reflections will be shown here -->
                </div>
            </section>
            
            <div class="text-center mt-8">
                <button id="download-discussion-report" class="bg-teal-600 text-white font-bold px-8 py-3 rounded-lg hover:bg-teal-700 transition shadow-md">
                    [í† ë¡  ìë£Œ ë‚´ë ¤ë°›ê¸°]
                </button>
                <p class="text-sm text-slate-500 mt-2">í† ë¡  ë‚´ìš©ê³¼ í™œë™ ì†Œê°ì„ [HTML] íŒŒì¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤.</p>
            </div>
        </div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getFirestore, doc, collection, onSnapshot, addDoc, serverTimestamp, query, orderBy, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

    // --- Firebase Setup ---
    let db, auth;
    try {
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        if (!firebaseConfig) {
            throw new Error("Firebase config not found.");
        }
        const app = initializeApp(firebaseConfig);
        db = getFirestore(app);
        auth = getAuth(app);

        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
            await signInWithCustomToken(auth, __initial_auth_token);
        } else {
            await signInAnonymously(auth);
        }
    } catch(e) {
        console.error("Firebase initialization failed:", e);
        alert("ì‹¤ì‹œê°„ í˜‘ì—… ê¸°ëŠ¥ì„ ì´ˆê¸°í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.");
    }

    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
    
    const scenarios = {
        recruiter: {
            title: "AI ë©´ì ‘ê´€ì˜ í¸ê²¬",
            description: "AI ë©´ì ‘ê´€ì´ íŠ¹ì • í¸ê²¬ì„ í•™ìŠµí•˜ì—¬ ì§€ì›ìë¥¼ ë¶ˆê³µì •í•˜ê²Œ í‰ê°€í•˜ëŠ” ìƒí™©ì„ íƒìƒ‰í•©ë‹ˆë‹¤.",
            storyboard: [
                { sceneTitle: "ìƒí™© ì œì‹œ: AI ë©´ì ‘, ê³¼ì—° ê³µì •í• ê¹Œ?", imageText: "A hopeful student preparing for an AI interview, optimistic expression, futuristic interface", dialogue: "ë“œë””ì–´ ë‚´ê°€ ê¿ˆê¾¸ë˜ íšŒì‚¬ì— ì§€ì›í•  ì‹œê°„ì´ì•¼! ìµœì‹  AI ë©´ì ‘ì´ë¼ë‹ˆ, ì •ë§ ê³µì •í•˜ê²Œ ë‚˜ë¥¼ í‰ê°€í•´ ì£¼ê² ì§€?" },
                { sceneTitle: "ë¬¸ì œ ë°œìƒ: í¸ê²¬ì„ í•™ìŠµí•œ AI", imageText: "A confused student looking at a screen with an AI interviewer bot asking strange, non-relevant questions", dialogue: "AI ë©´ì ‘ê´€: ë‹¹ì‹ ì´ ì¡¸ì—…í•œ ê³ ë“±í•™êµì˜ ìœ„ì¹˜ëŠ” ì–´ë””ì¸ê°€ìš”? ì£¼ë§ì—ëŠ” ì£¼ë¡œ ì–´ë–¤ í™œë™ì„ í•˜ë‚˜ìš”?\në‚˜ (ì†ë§ˆìŒ): ë‚´ ê¸°ìˆ ì´ë‚˜ ê²½í—˜ì´ ì•„ë‹ˆë¼ ì™œ ì´ëŸ° ê±¸ ë¬¼ì–´ë³´ì§€...?" },
                { sceneTitle: "ê°ˆë“± ì‹¬í™”: ë…¸ë ¥ì˜ ë°°ì‹ ", imageText: "A frustrated student looking at a rejection email on their phone, friend comforting them", dialogue: "ì¹œêµ¬: ê·¸ íšŒì‚¬ AI ë©´ì ‘ê´€ì´ íŠ¹ì • ì§€ì—­ ì¶œì‹  ì§€ì›ìë“¤ì—ê²Œ ë‚®ì€ ì ìˆ˜ë¥¼ ì¤€ë‹¤ëŠ” ì†Œë¬¸ì´ ìˆì–´. í¸ê²¬ì„ í•™ìŠµí–ˆë‚˜ ë´.\në‚˜: ë§ë„ ì•ˆ ë¼! ë‚´ ë…¸ë ¥ê³¼ ìƒê´€ì—†ì´ ê¸°íšŒì¡°ì°¨ ì–»ì§€ ëª»í–ˆë‹¤ë‹ˆ..." },
                { sceneTitle: "ìœ¤ë¦¬ì  ì§ˆë¬¸: ëˆ„êµ¬ì˜ ì±…ì„ì¼ê¹Œ?", imageText: "Silhouettes of a developer, a CEO, and a robot under a giant question mark", dialogue: "AIê°€ í¸ê²¬ì„ í•™ìŠµí•´ ë¶ˆê³µì •í•œ ê²°ì •ì„ ë‚´ë ¸ë‹¤ë©´, ê·¸ ì±…ì„ì€ ëˆ„êµ¬ì—ê²Œ ìˆì„ê¹Œìš”? (1.ê°œë°œì, 2.íšŒì‚¬, 3.AI)" }
            ],
            hint: "AIì˜ ê³µì •ì„±ì„ í™•ë³´í•˜ê¸° ìœ„í•œ ê¸°ìˆ ì , ì œë„ì  ì¥ì¹˜ì—ëŠ” ë¬´ì—‡ì´ ìˆì„ê¹Œìš”? (ì˜ˆ: ë°ì´í„° í¸í–¥ì„± ê²€í† , AI ê²°ì • ê³¼ì •ì˜ íˆ¬ëª…ì„± í™•ë³´, ì‚¬ëŒì˜ ìµœì¢… ê²€í†  ì ˆì°¨ ë“±)",
            discussion: {
                topic: "AI ë©´ì ‘ê´€ì˜ ê²°ì •ì€ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ”ê°€?",
                pro: "ê°œë°œì/íšŒì‚¬ì˜ ì±…ì„ì´ë‹¤",
                con: "AI ìì²´/ë³µí•©ì  ì±…ì„ì´ë‹¤"
            }
        },
        car: {
            title: "ììœ¨ì£¼í–‰ì°¨ì˜ ë”œë ˆë§ˆ",
            description: "ì‚¬ê³ ê°€ ë¶ˆê°€í”¼í•œ ìƒí™©ì—ì„œ ììœ¨ì£¼í–‰ì°¨ê°€ ëˆ„êµ¬ë¥¼ ë³´í˜¸í•˜ë„ë¡ í”„ë¡œê·¸ë˜ë°ë˜ì–´ì•¼ í•˜ëŠ”ì§€ ê³ ë¯¼í•©ë‹ˆë‹¤.",
            storyboard: [
                { sceneTitle: "ìƒí™© ì œì‹œ: í¸ë¦¬í•¨ ì†ì˜ ìœ„í—˜", imageText: "A happy family inside a self-driving car, enjoying the ride through a city", dialogue: "ì•„ë¹ : ììœ¨ì£¼í–‰ ìë™ì°¨ ì •ë§ í¸í•˜ë‹¤. ì´ì œ ìš´ì „ ê±±ì • ì—†ì´ ê°€ì¡±ë“¤ì´ë‘ ì´ì•¼ê¸°ë„ ë‚˜ëˆŒ ìˆ˜ ìˆë„¤.\nì•„ì´: ì™€, ìë™ì°¨ê°€ ì•Œì•„ì„œ ê°€ìš”!" },
                { sceneTitle: "ë¬¸ì œ ë°œìƒ: í”¼í•  ìˆ˜ ì—†ëŠ” ì‚¬ê³ ", imageText: "View from inside a self-driving car's dashboard, showing children suddenly running into the street", dialogue: "(ì‹œìŠ¤í…œ ê²½ê³ ìŒ): ì‚- ì‚- ì „ë°© ë³´í–‰ì ê°ì§€! ì¶©ëŒ ì˜ˆìƒ!\nì—„ë§ˆ: ì–´ë¨¸! ì–˜ë“¤ì•„!" },
                { sceneTitle: "ê°ˆë“± ì‹¬í™”: ì„ íƒì˜ ê¸°ë¡œ", imageText: "A diagram showing two paths for a car: one hitting pedestrians, the other swerving into a wall", dialogue: "ì°¨ëŸ‰ ì‹œìŠ¤í…œ (ë‚´ë ˆì´ì…˜): ì„ íƒì§€ ë¶„ì„ ì¤‘... ì˜µì…˜ A: íƒ‘ìŠ¹ì ë³´í˜¸. ì˜ˆìƒ ê²°ê³¼: ë³´í–‰ì í° ë¶€ìƒ. ì˜µì…˜ B: ë³´í–‰ì ë³´í˜¸. ì˜ˆìƒ ê²°ê³¼: íƒ‘ìŠ¹ì í° ë¶€ìƒ." },
                { sceneTitle: "ìœ¤ë¦¬ì  ì§ˆë¬¸: ëˆ„êµ¬ë¥¼ ìœ„í•œ ì•Œê³ ë¦¬ì¦˜?", imageText: "A complex, glowing flowchart representing an ethical algorithm for a self-driving car", dialogue: "ì‚¬ê³ ë¥¼ í”¼í•  ìˆ˜ ì—†ëŠ” ìƒí™©ì—ì„œ, ììœ¨ì£¼í–‰ ìë™ì°¨ëŠ” ëˆ„êµ¬ë¥¼ ìš°ì„ ìœ¼ë¡œ ë³´í˜¸í•˜ë„ë¡ ë§Œë“¤ì–´ì•¼ í• ê¹Œìš”? (1.íƒ‘ìŠ¹ì, 2.ë³´í–‰ì, 3.ìƒí™©ì— ë”°ë¼)" }
            ],
            hint: "ì´ëŸ¬í•œ ìœ¤ë¦¬ì  ê²°ì •ì„ ëˆ„ê°€ ë‚´ë ¤ì•¼ í• ê¹Œìš”? (ê°œë°œì, ì œì¡°ì‚¬, ìë™ì°¨ ì†Œìœ ì£¼, í˜¹ì€ ì‚¬íšŒì  í•©ì˜) 'íŠ¸ë¡¤ë¦¬ ë”œë ˆë§ˆ'ì— ëŒ€í•´ ìƒê°í•´ë³´ì„¸ìš”.",
            discussion: {
                topic: "ììœ¨ì£¼í–‰ì°¨ëŠ” íƒ‘ìŠ¹ìì™€ ë³´í–‰ì ì¤‘ ëˆ„êµ¬ë¥¼ ìš°ì„ í•´ì•¼ í•˜ëŠ”ê°€?",
                pro: "íƒ‘ìŠ¹ìë¥¼ ìš°ì„ í•´ì•¼ í•œë‹¤",
                con: "ë³´í–‰ìë¥¼ ìš°ì„ í•´ì•¼ í•œë‹¤"
            }
        },
        cctv: {
            title: "AI ê°ì‹œì¹´ë©”ë¼ì˜ ë‘ ì–¼êµ´",
            description: "í•™êµ ì•ˆì „ì„ ìœ„í•´ ë„ì…ëœ AI CCTVê°€ í•™ìƒë“¤ì˜ ì‚¬ìƒí™œì„ ì¹¨í•´í•˜ëŠ” ë¬¸ì œë¥¼ ë‹¤ë£¹ë‹ˆë‹¤.",
            storyboard: [
                { sceneTitle: "ìƒí™© ì œì‹œ: ì•ˆì „ì„ ìœ„í•œ ê°ì‹œ", imageText: "A sleek, modern AI-powered CCTV camera mounted on a school building wall", dialogue: "êµì¥ì„ ìƒë‹˜: í•™êµ í­ë ¥ ì˜ˆë°©ì„ ìœ„í•´ ìµœì²¨ë‹¨ AI CCTVë¥¼ ë„ì…í–ˆìŠµë‹ˆë‹¤. ì´ì œ ëª¨ë‘ê°€ ì•ˆì „í•  ê²ë‹ˆë‹¤." },
                { sceneTitle: "ë¬¸ì œ ë°œìƒ: ë†€ë¼ìš´ íš¨ê³¼ì™€ ê·¸ë¦¼ì", imageText: "An AI drone camera intervening between two students about to fight, shining a light", dialogue: "ë‰´ìŠ¤: AI CCTVê°€ í•™ìƒ ê°„ì˜ ë‹¤íˆ¼ì„ ì¡°ê¸°ì— ë°œê²¬í•˜ê³  ê²½ê³ ë¥¼ ë³´ë‚´ í° ì‹¸ì›€ì„ ë§‰ì•˜ìŠµë‹ˆë‹¤. í•™ë¶€ëª¨ë“¤ë¡œë¶€í„° í° í˜¸ì‘ì„ ì–»ê³  ìˆìŠµë‹ˆë‹¤." },
                { sceneTitle: "ê°ˆë“± ì‹¬í™”: í†µì œë˜ëŠ” í•™êµìƒí™œ", imageText: "Students in a schoolyard feeling watched and uncomfortable under the gaze of multiple AI cameras", dialogue: "í•™ìƒ1: ê·¸ëƒ¥ ì¹œêµ¬ë‘ ì¥ë‚œì¹œ ê±´ë° ìê¾¸ ê²½ê³ ìŒì´ ìš¸ë ¤. ê°ì‹œë‹¹í•˜ëŠ” ê¸°ë¶„ì´ì•¼.\ní•™ìƒ2: ë‚˜ë„. ë‚´ ëª¨ë“  í–‰ë™ì´ ê¸°ë¡ëœë‹¤ê³  ìƒê°í•˜ë‹ˆ ì†Œë¦„ ë¼ì³." },
                { sceneTitle: "ìœ¤ë¦¬ì  ì§ˆë¬¸: ì•ˆì „ vs ì‚¬ìƒí™œ", imageText: "A balancing scale with 'Safety' on one side and 'Privacy' on the other", dialogue: "í•™ìƒë“¤ì˜ ì•ˆì „ì„ ìœ„í•œ AI ê°ì‹œëŠ” ì–´ë””ê¹Œì§€ í—ˆìš©ë  ìˆ˜ ìˆì„ê¹Œìš”? ì•ˆì „ê³¼ ì‚¬ìƒí™œì˜ ê· í˜•ì ì€ ì–´ë””ì¼ê¹Œìš”?" }
            ],
            hint: "AIê°€ ìˆ˜ì§‘í•œ ê°œì¸ì •ë³´(ì–¼êµ´, í–‰ë™ ë°ì´í„°)ëŠ” ì–´ë–»ê²Œ ê´€ë¦¬ë˜ì–´ì•¼ í• ê¹Œìš”? ë§Œì•½ AIê°€ í•™ìƒì„ ì˜¤ì¸í•˜ì—¬ ì˜ëª»ëœ íŒë‹¨ì„ ë‚´ë¦°ë‹¤ë©´ ëˆ„ê°€ ì±…ì„ì ¸ì•¼ í• ê¹Œìš”?",
            discussion: {
                topic: "í•™êµ ë‚´ AI CCTV ë„ì…ì€ ì •ë‹¹í•œê°€?",
                pro: "ì•ˆì „ì„ ìœ„í•´ í•„ìš”í•˜ë‹¤",
                con: "ì‚¬ìƒí™œ ì¹¨í•´ë‹¤"
            }
        },
        art: {
            title: "AI í™”ê°€, ì°½ì‘ì¸ê°€ ë³µì œì¸ê°€?",
            description: "AIë¡œ ê·¸ë¦° ê·¸ë¦¼ì´ ì˜ˆìˆ  ëŒ€íšŒì—ì„œ ìˆ˜ìƒí•˜ë©° ë²Œì–´ì§€ëŠ” ì €ì‘ê¶Œê³¼ ì°½ì˜ì„±ì— ëŒ€í•œ ë…¼ë€ì„ íƒêµ¬í•©ë‹ˆë‹¤.",
            storyboard: [
                { sceneTitle: "ìƒí™© ì œì‹œ: ìƒˆë¡œìš´ ì˜ˆìˆ ì˜ íƒ„ìƒ", imageText: "A student creating a beautiful, intricate digital artwork on a computer using an AI art generator", dialogue: "ìš°ì™€! ë‚´ê°€ ì…ë ¥í•œ ë‹¨ì–´ ëª‡ ê°œë¡œ ì´ë ‡ê²Œ ë©‹ì§„ ê·¸ë¦¼ì´ ë§Œë“¤ì–´ì§€ë‹¤ë‹ˆ! ì´ê±¸ë¡œ ë¯¸ìˆ  ëŒ€íšŒì— ë‚˜ê°€ì•¼ê² ì–´." },
                { sceneTitle: "ë¬¸ì œ ë°œìƒ: ì˜ˆìƒì¹˜ ëª»í•œ ìˆ˜ìƒ", imageText: "The student happily receiving a gold medal at an art competition for their AI-generated artwork", dialogue: "ì‹¬ì‚¬ìœ„ì›: ì •ë§ ë…ì°½ì ì´ê³  ì°½ì˜ì ì¸ ì‘í’ˆì…ë‹ˆë‹¤! ëŒ€ìƒì…ë‹ˆë‹¤!\në‚˜: ê°ì‚¬í•©ë‹ˆë‹¤! ì œ ì•„ì´ë””ì–´ë¥¼ AIê°€ ë©‹ì§€ê²Œ í‘œí˜„í•´ì¤¬ì–´ìš”." },
                { sceneTitle: "ê°ˆë“± ì‹¬í™”: ì›ì‘ìì˜ ë“±ì¥", imageText: "An angry artist confronting the student, showing how the AI art is very similar to their own style", dialogue: "í™”ê°€: ì´ ê·¸ë¦¼ì€ ë‚´ í™”í’ì„ ê·¸ëŒ€ë¡œ ë² ê¼ˆì–ì•„! ë‚´ í—ˆë½ë„ ì—†ì´ ë‚´ ê·¸ë¦¼ì„ AI í•™ìŠµì— ì“°ë‹¤ë‹ˆ, ì´ê±´ ë„ë‘‘ì§ˆì´ì•¼!\në‚˜: ì €ëŠ” ê·¸ëƒ¥ ì•„ì´ë””ì–´ë¥¼ ëƒˆì„ ë¿ì¸ë°ìš”..." },
                { sceneTitle: "ìœ¤ë¦¬ì  ì§ˆë¬¸: ì§„ì •í•œ ì°½ì‘ìëŠ” ëˆ„êµ¬?", imageText: "A question mark hovering between the student, an AI robot, and the original artist", dialogue: "AIê°€ ë§Œë“  ì˜ˆìˆ  ì‘í’ˆì˜ ì €ì‘ê¶Œì€ ëˆ„êµ¬ì—ê²Œ ìˆì„ê¹Œìš”? (1.AI ì‚¬ìš©ì, 2.AI ê°œë°œì, 3.AIê°€ í•™ìŠµí•œ ì›ë³¸ ì˜ˆìˆ ê°€)" }
            ],
            hint: "ì¸ê°„ì˜ 'ì°½ì˜ì„±'ì´ë€ ë¬´ì—‡ì¼ê¹Œìš”? AIê°€ ë§Œë“  ê²°ê³¼ë¬¼ì€ ì¸ê°„ì˜ ì°½ì‘ë¬¼ê³¼ ë™ë“±í•˜ê²Œ ì¸ì •ë°›ì„ ìˆ˜ ìˆì„ê¹Œìš”? ì €ì‘ê¶Œë²•ì€ ì–´ë–»ê²Œ ë°”ë€Œì–´ì•¼ í• ê¹Œìš”?",
            discussion: {
                topic: "AIê°€ ìƒì„±í•œ ì°½ì‘ë¬¼ì˜ ì €ì‘ê¶Œì„ ì¸ì •í•´ì•¼ í•˜ëŠ”ê°€?",
                pro: "ì‚¬ìš©ìì˜ ì°½ì‘ë¬¼ì´ë‹¤",
                con: "ì›ë³¸ ì €ì‘ê¶Œì„ ì¡´ì¤‘í•´ì•¼ í•œë‹¤"
            }
        }
    };

    let currentScenarioKey = null;
    let imageUploadTargetContainer = null;
    let unsubscribeListeners = [];

    function initializeAppUI() {
        const scenarioList = document.getElementById('scenario-list');
        scenarioList.innerHTML = ''; // Clear list before populating
        Object.keys(scenarios).forEach(key => {
            const scenario = scenarios[key];
            const card = document.createElement('div');
            card.className = 'scenario-card bg-white p-6 rounded-2xl shadow-md cursor-pointer';
            card.innerHTML = `<h3 class="text-xl font-bold text-slate-900">${scenario.title}</h3><p class="text-slate-600 mt-2">${scenario.description}</p>`;
            card.onclick = (e) => selectScenario(key, e.currentTarget);
            scenarioList.appendChild(card);
        });

        document.getElementById('hint-button').onclick = () => document.getElementById('hint-box').classList.toggle('hidden');
        document.getElementById('download-presentation').onclick = downloadPresentation;
        
        const modal = document.getElementById('discussion-modal');
        document.getElementById('start-discussion-btn').onclick = () => modal.classList.remove('hidden');
        document.getElementById('close-modal-btn').onclick = () => modal.classList.add('hidden');

        document.getElementById('pro-send-btn').onclick = () => addMessage('pro');
        document.getElementById('con-send-btn').onclick = () => addMessage('con');
        document.getElementById('save-reflection-btn').onclick = saveReflection;
        document.getElementById('download-discussion-report').onclick = downloadDiscussionReportAsHtml;
        
        ['pro-input', 'con-input'].forEach(id => {
            document.getElementById(id).addEventListener('keypress', (e) => {
                if (e.key === 'Enter') { e.preventDefault(); addMessage(id.split('-')[0]); }
            });
        });

        const imageUploadInput = document.getElementById('image-upload-input');
        imageUploadInput.onchange = (event) => {
            if (event.target.files && event.target.files[0] && imageUploadTargetContainer) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    imageUploadTargetContainer.innerHTML = `<img src="${e.target.result}" class="w-full h-full object-cover rounded-lg">`;
                }
                reader.readAsDataURL(event.target.files[0]);
            }
        };

        ['discussion-title-input', 'pro-title-input', 'con-title-input'].forEach(id => {
            document.getElementById(id).addEventListener('blur', updateDiscussionTitles);
        });
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeAppUI);
    } else {
        initializeAppUI();
    }

    function resetWorkspace() {
        unsubscribeListeners.forEach(unsub => unsub());
        unsubscribeListeners = [];
        
        document.getElementById('storyboard-container').innerHTML = '';
        document.getElementById('solution-textarea').value = '';
        document.getElementById('pro-chat').innerHTML = '';
        document.getElementById('con-chat').innerHTML = '';
        document.getElementById('pro-input').value = '';
        document.getElementById('con-input').value = '';
        document.getElementById('name-input').value = '';
        document.getElementById('reflection-textarea').value = '';
        document.getElementById('reflection-list').innerHTML = '';
        document.getElementById('hint-box').classList.add('hidden');
        document.getElementById('discussion-modal').classList.add('hidden');
    }

    function selectScenario(key, selectedCardElement) {
        resetWorkspace();
        currentScenarioKey = key;

        document.querySelectorAll('.scenario-card').forEach(card => card.classList.remove('selected-scenario'));
        selectedCardElement.classList.add('selected-scenario');
        
        const currentScenario = scenarios[key];
        document.getElementById('workshop-area').classList.remove('hidden');

        const storyboardContainer = document.getElementById('storyboard-container');
        storyboardContainer.innerHTML = '';
        currentScenario.storyboard.forEach((scene, index) => {
            const sceneId = `scene-${index}`;
            const sceneEl = document.createElement('div');
            sceneEl.id = sceneId;
            sceneEl.className = 'storyboard-scene bg-white p-6 rounded-2xl shadow-lg';
            sceneEl.innerHTML = `
                <h3 class="font-bold text-xl mb-4 text-center text-slate-700">${scene.sceneTitle}</h3>
                <div class="grid md:grid-cols-2 gap-6 items-center">
                    <div class="image-container bg-slate-200 rounded-lg h-64 flex flex-col items-center justify-center p-2">
                        <p class="text-slate-500">ì´ë¯¸ì§€ë¥¼ ìƒì„± ë˜ëŠ” ì¶”ê°€í•´ì£¼ì„¸ìš”.</p>
                    </div>
                    <div class="h-full speech-bubble p-4">
                        <textarea class="w-full h-full bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-400 rounded-lg p-2" data-title="${scene.sceneTitle}">${scene.dialogue}</textarea>
                    </div>
                </div>
                <div class="text-center mt-4 flex justify-center items-center gap-4">
                    <button class="generate-image-btn bg-teal-500 text-white px-4 py-2 rounded-lg hover:bg-teal-600 transition" data-prompt="${scene.imageText}" data-target="${sceneId}">[ì´ë¯¸ì§€ ìƒì„±]</button>
                    <button class="upload-image-btn bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition" data-target="${sceneId}">[ì´ë¯¸ì§€ ì¶”ê°€]</button>
                </div>`;
            storyboardContainer.appendChild(sceneEl);
        });
        
        document.querySelectorAll('.generate-image-btn').forEach(button => {
            button.onclick = (e) => {
                const prompt = e.target.dataset.prompt;
                const targetContainer = document.querySelector(`#${e.target.dataset.target} .image-container`);
                generateImage(prompt, targetContainer);
            };
        });

        document.querySelectorAll('.upload-image-btn').forEach(button => {
            button.onclick = (e) => {
                imageUploadTargetContainer = document.querySelector(`#${e.target.dataset.target} .image-container`);
                document.getElementById('image-upload-input').click();
            };
        });
        
        document.getElementById('hint-text').innerText = currentScenario.hint;
        
        setupRealtimeListeners();
        document.getElementById('workshop-area').scrollIntoView({ behavior: 'smooth' });
    }

    function setupRealtimeListeners() {
        if (!currentScenarioKey) return;
        const scenarioDocRef = doc(db, "artifacts", appId, "public", "data", "workshops", currentScenarioKey);

        const unsubDoc = onSnapshot(scenarioDocRef, (docSnap) => {
            const data = docSnap.data();
            const defaults = scenarios[currentScenarioKey].discussion;
            document.getElementById('discussion-title-input').value = data?.topic || defaults.topic;
            document.getElementById('pro-title-input').value = data?.proTitle || defaults.pro;
            document.getElementById('con-title-input').value = data?.conTitle || defaults.con;
        });
        unsubscribeListeners.push(unsubDoc);

        ['pro', 'con'].forEach(type => {
            const chatCollectionRef = collection(scenarioDocRef, `${type}Messages`);
            const q = query(chatCollectionRef, orderBy("timestamp"));
            const unsubChat = onSnapshot(q, (snapshot) => {
                const chatBox = document.getElementById(`${type}-chat`);
                chatBox.innerHTML = '';
                snapshot.forEach(doc => {
                    const msgEl = document.createElement('div');
                    msgEl.className = 'p-2 rounded-lg bg-white shadow-sm';
                    msgEl.textContent = doc.data().text;
                    chatBox.appendChild(msgEl);
                });
                chatBox.scrollTop = chatBox.scrollHeight;
            });
            unsubscribeListeners.push(unsubChat);
        });

        const reflectionsCollectionRef = collection(scenarioDocRef, 'reflections');
        const qReflections = query(reflectionsCollectionRef, orderBy("timestamp", "desc"));
        const unsubReflections = onSnapshot(qReflections, (snapshot) => {
            const reflectionList = document.getElementById('reflection-list');
            reflectionList.innerHTML = '';
            snapshot.forEach(doc => {
                const data = doc.data();
                const reflectionEl = document.createElement('div');
                reflectionEl.className = 'bg-green-50 p-4 rounded-lg border border-green-200';
                reflectionEl.innerHTML = `<p class="font-bold text-green-800">${data.name || 'ìµëª…'}</p><p class="mt-1 text-slate-700">${data.text}</p>`;
                reflectionList.appendChild(reflectionEl);
            });
        });
        unsubscribeListeners.push(unsubReflections);
    }
    
    async function updateDiscussionTitles() {
        if (!currentScenarioKey) return;
        const scenarioDocRef = doc(db, "artifacts", appId, "public", "data", "workshops", currentScenarioKey);
        await setDoc(scenarioDocRef, {
            topic: document.getElementById('discussion-title-input').value,
            proTitle: document.getElementById('pro-title-input').value,
            conTitle: document.getElementById('con-title-input').value
        }, { merge: true });
    }

    async function addMessage(type) {
        if (!currentScenarioKey) return;
        const scenarioDocRef = doc(db, "artifacts", appId, "public", "data", "workshops", currentScenarioKey);
        const input = document.getElementById(`${type}-input`);
        const messageText = input.value.trim();
        if (messageText) {
            const chatCollectionRef = collection(scenarioDocRef, `${type}Messages`);
            await addDoc(chatCollectionRef, {
                text: messageText,
                timestamp: serverTimestamp()
            });
            input.value = '';
        }
    }
    
    async function saveReflection() {
        if (!currentScenarioKey) return;
        const scenarioDocRef = doc(db, "artifacts", appId, "public", "data", "workshops", currentScenarioKey);
        const name = document.getElementById('name-input').value.trim();
        const text = document.getElementById('reflection-textarea').value.trim();
        if(text) {
            const reflectionsCollectionRef = collection(scenarioDocRef, 'reflections');
            await addDoc(reflectionsCollectionRef, {
                name: name || "ìµëª…",
                text: text,
                timestamp: serverTimestamp()
            });
            document.getElementById('reflection-textarea').value = '';
        }
    }

    async function generateImage(prompt, container) {
        container.innerHTML = '<div class="loader"></div><p class="mt-2 text-slate-500">ì´ë¯¸ì§€ ìƒì„± ì¤‘...</p>';
        
        const apiKey = ""; 
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;
        const payload = {
            instances: [{ prompt: `A vivid, storybook-style illustration of: ${prompt}` }],
            parameters: { "sampleCount": 1 }
        };

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            const result = await response.json();

            if (!response.ok) {
                const errorMsg = result?.error?.message || `HTTP error! Status: ${response.status}`;
                throw new Error(errorMsg);
            }
            
            if (!result || Object.keys(result).length === 0) {
                 console.error("Invalid API response: Empty object received", result);
                 throw new Error("APIë¡œë¶€í„° ë¹ˆ ì‘ë‹µì„ ë°›ì•˜ìŠµë‹ˆë‹¤. ì•ˆì „ í•„í„°ì— ì˜í•´ ì°¨ë‹¨ë˜ì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
            }

            const base64Data = result.predictions?.[0]?.bytesBase64Encoded;

            if (base64Data) {
                const imageUrl = `data:image/png;base64,${base64Data}`;
                container.innerHTML = `<img src="${imageUrl}" class="w-full h-full object-cover rounded-lg">`;
            } else {
                console.error("Invalid API response: No image data found", result);
                const errorMsg = result?.error?.message || "API ì‘ë‹µì— ì´ë¯¸ì§€ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.";
                throw new Error(errorMsg);
            }
        } catch (error) {
            console.error("Image generation failed:", error);
            container.innerHTML = `<p class="text-red-500">ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨: ${error.message}</p>`;
        }
    }

    async function downloadPresentation() {
        if (!currentScenarioKey) { alert("ë¨¼ì € ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”."); return; }
        alert('ìŠ¤í† ë¦¬ë³´ë“œì™€ í•´ê²° ë°©ì•ˆì„ ìŠ¬ë¼ì´ë“œ í˜•ì‹ì˜ PDFë¡œ ë³€í™˜í•©ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.');
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('l', 'mm', 'a4');
        let isFirstPage = true;

        const scenes = document.querySelectorAll('.storyboard-scene');
        for (const scene of scenes) {
            const canvas = await html2canvas(scene, { scale: 2, useCORS: true, allowTaint: true });
            if (!isFirstPage) { doc.addPage(); }
            doc.addImage(canvas.toDataURL('image/jpeg', 0.9), 'JPEG', 10, 10, 277, 190);
            isFirstPage = false;
        }

        const solutionElement = document.getElementById('solution-section');
        const solutionCanvas = await html2canvas(solutionElement, { scale: 2, useCORS: true, allowTaint: true });
        doc.addPage();
        doc.addImage(solutionCanvas.toDataURL('image/jpeg', 0.9), 'JPEG', 10, 10, 277, 190);

        doc.save(`${scenarios[currentScenarioKey].title}_ë°œí‘œìë£Œ.pdf`);
    }

    function downloadDiscussionReportAsHtml() {
        if (!currentScenarioKey) { alert("ë¨¼ì € ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”."); return; }
        alert('í† ë¡  ìë£Œì™€ í™œë™ ì†Œê°ì„ HTML íŒŒì¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤.');
        const currentScenario = scenarios[currentScenarioKey];
        let reportHtml = `
            <!DOCTYPE html>
            <html lang="ko">
            <head>
                <meta charset="UTF-8">
                <title>AI ìœ¤ë¦¬ í† ë¡  ê²°ê³¼ ë³´ê³ ì„œ</title>
                <script src="https://cdn.tailwindcss.com"><\/script>
                <style>
                    body { font-family: 'Noto Sans KR', sans-serif; }
                    @media print {
                        body { -webkit-print-color-adjust: exact; }
                        .no-print { display: none; }
                    }
                <\/style>
            </head>
            <body class="bg-gray-100 p-10">
                <div class="max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-lg">
                    <h1 class="text-3xl font-bold text-center mb-2">AI ìœ¤ë¦¬ í† ë¡  ê²°ê³¼ ë³´ê³ ì„œ</h1>
                    <p class="text-center text-gray-500 mb-8">ì‹œë‚˜ë¦¬ì˜¤: ${currentScenario.title}</p>
        `;

        reportHtml += `<h2 class="text-2xl font-semibold border-b-2 border-gray-300 pb-2 mb-4 mt-10">1. ì°¬ë°˜ í† ë¡ </h2>`;
        const discussionTopic = document.getElementById('discussion-title-input').value;
        const proTitle = document.getElementById('pro-title-input').value;
        const conTitle = document.getElementById('con-title-input').value;
        
        reportHtml += `<p class="text-center font-bold text-lg mb-4">${discussionTopic}</p>`;
        reportHtml += `<div class="grid grid-cols-2 gap-6">`;
        let proMessages = '';
        document.querySelectorAll('#pro-chat div').forEach(msg => { proMessages += `<li class="bg-white p-2 rounded">${msg.textContent}</li>`; });
        reportHtml += `
            <div>
                <h3 class="text-center font-semibold bg-blue-100 text-blue-800 p-2 rounded-t-lg">${proTitle}</h3>
                <ul class="bg-gray-50 p-3 rounded-b-lg space-y-2 h-48 overflow-y-auto">${proMessages || '<li>ì˜ê²¬ ì—†ìŒ</li>'}</ul>
            </div>
        `;
        let conMessages = '';
        document.querySelectorAll('#con-chat div').forEach(msg => { conMessages += `<li class="bg-white p-2 rounded">${msg.textContent}</li>`; });
        reportHtml += `
            <div>
                <h3 class="text-center font-semibold bg-red-100 text-red-800 p-2 rounded-t-lg">${conTitle}</h3>
                <ul class="bg-gray-50 p-3 rounded-b-lg space-y-2 h-48 overflow-y-auto">${conMessages || '<li>ì˜ê²¬ ì—†ìŒ</li>'}</ul>
            </div>
        `;
        reportHtml += `</div>`;

        reportHtml += `<h2 class="text-2xl font-semibold border-b-2 border-gray-300 pb-2 mb-4 mt-10">2. í™œë™ ì†Œê°</h2>`;
        let reflectionMessages = '';
         document.querySelectorAll('#reflection-list > div').forEach(reflection => {
             reflectionMessages += `<div class="bg-green-50 p-4 rounded-lg border border-green-200 mt-2">${reflection.innerHTML}</div>`
         });
        reportHtml += `<div>${reflectionMessages || '<p>ì‘ì„±ëœ ì†Œê°ì´ ì—†ìŠµë‹ˆë‹¤.</p>'}</div>`;

        reportHtml += `
                </div>
                <div class="text-center mt-6 no-print">
                    <p class="text-gray-600">ì´ í˜ì´ì§€ë¥¼ ì¸ì‡„(Ctrl+P)í•˜ì—¬ PDFë¡œ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
            </body>
            </html>
        `;

        const blob = new Blob([reportHtml], { type: 'text/html;charset=utf-8' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `${currentScenario.title}_í† ë¡ ìë£Œ.html`;
        link.click();
    }
</script>
</body>
</html>

